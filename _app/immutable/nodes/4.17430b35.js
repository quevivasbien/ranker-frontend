import{a as G,u as L}from"../chunks/stores.da387759.js";import{k as $,s as x,r as ee,e as J,o as te,l as se,n as A}from"../chunks/scheduler.d3ab1ae5.js";import{S as oe,i as le,g as w,m as O,s as z,h as I,j as T,n as U,f as p,c as N,k as C,a as D,y as v,z as K,o as ne,d as V,b as X,t as M,C as re,p as Y,A as ae,r as ce,u as ie,v as ue,w as fe}from"../chunks/index.543365ac.js";import{e as Q}from"../chunks/each.e59479a4.js";import{I as de}from"../chunks/ItemInfo.e223d29d.js";async function _e(n){const t=async f=>{const m=await n.fetch(`https://ranker-backend.fly.dev/scores/${f}`);return m.ok?await m.json():(console.log("Error fetching global score",m),null)},s=async f=>{const m=$(L);if(!m)return console.log("No user info when fetching user score"),null;const d=await n.fetch(`https://ranker-backend.fly.dev/scores/${f}/${m.username}`,{headers:{Authorization:m.token}});return d.ok?await d.json():(d.status!==404&&console.log("Error fetching user score",d),null)},o=await(await n.fetch("https://ranker-backend.fly.dev/items")).json();return G.set(o),{getGlobalScore:t,getUserScore:s}}const we=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));function R(n,t,s){const e=n.slice();return e[11]=t[s],e}function me(n){let t,s="Loading...";return{c(){t=w("p"),t.textContent=s},l(e){t=I(e,"P",{["data-svelte-h"]:!0}),ae(t)!=="svelte-qdsr2u"&&(t.textContent=s)},m(e,o){D(e,t,o)},p:A,i:A,o:A,d(e){e&&p(t)}}}function he(n){let t,s;return t=new de({props:{item:n[11],globalScore:n[0].get(n[11].name),userScore:n[4]==null?void 0:n[1].get(n[11].name)}}),{c(){ce(t.$$.fragment)},l(e){ie(t.$$.fragment,e)},m(e,o){ue(t,e,o),s=!0},p(e,o){const f={};o&8&&(f.item=e[11]),o&9&&(f.globalScore=e[0].get(e[11].name)),o&26&&(f.userScore=e[4]==null?void 0:e[1].get(e[11].name)),t.$set(f)},i(e){s||(V(t.$$.fragment,e),s=!0)},o(e){M(t.$$.fragment,e),s=!1},d(e){fe(t,e)}}}function W(n){let t,s,e,o,f,m;const d=[he,me],h=[];function g(u,a){return a&9&&(s=null),s==null&&(s=u[0].get(u[11].name)!==void 0),s?0:1}return e=g(n,-1),o=h[e]=d[e](n),{c(){t=w("div"),o.c(),f=z(),this.h()},l(u){t=I(u,"DIV",{class:!0});var a=T(t);o.l(a),f=N(a),a.forEach(p),this.h()},h(){C(t,"class","m-8 sm:w-1/4")},m(u,a){D(u,t,a),h[e].m(t,null),v(t,f),m=!0},p(u,a){let y=e;e=g(u,a),e===y?h[e].p(u,a):(Y(),M(h[y],1,1,()=>{h[y]=null}),X(),o=h[e],o?o.p(u,a):(o=h[e]=d[e](u),o.c()),V(o,1),o.m(t,f))},i(u){m||(V(o),m=!0)},o(u){M(o),m=!1},d(u){u&&p(t),h[e].d()}}}function be(n){let t,s,e,o=n[3].length+"",f,m,d,h,g,u,a,y,E,_,b,S,j,P,k=Q(n[3]),r=[];for(let l=0;l<k.length;l+=1)r[l]=W(R(n,k,l));const Z=l=>M(r[l],1,1,()=>{r[l]=null});return{c(){t=w("div"),s=w("div"),e=O("Total items: "),f=O(o),m=z(),d=w("button"),h=O("Sort by global score"),u=z(),a=w("button"),y=O("Sort by user score"),_=z(),b=w("div");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){t=I(l,"DIV",{class:!0});var c=T(t);s=I(c,"DIV",{});var i=T(s);e=U(i,"Total items: "),f=U(i,o),i.forEach(p),m=N(c),d=I(c,"BUTTON",{class:!0});var B=T(d);h=U(B,"Sort by global score"),B.forEach(p),u=N(c),a=I(c,"BUTTON",{class:!0});var F=T(a);y=U(F,"Sort by user score"),F.forEach(p),c.forEach(p),_=N(l),b=I(l,"DIV",{class:!0});var H=T(b);for(let q=0;q<r.length;q+=1)r[q].l(H);H.forEach(p),this.h()},h(){C(d,"class","drop-shadow rounded bg-blue-200 disabled:bg-gray-300 p-2"),d.disabled=g=n[2]==="global",C(a,"class","drop-shadow rounded bg-blue-200 disabled:bg-gray-300 p-2"),a.disabled=E=n[2]==="user",C(t,"class","flex flex-row space-x-8 items-center"),C(b,"class","flex flex-wrap my-2")},m(l,c){D(l,t,c),v(t,s),v(s,e),v(s,f),v(t,m),v(t,d),v(d,h),v(t,u),v(t,a),v(a,y),D(l,_,c),D(l,b,c);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(b,null);S=!0,j||(P=[K(d,"click",n[7]),K(a,"click",n[8])],j=!0)},p(l,[c]){if((!S||c&8)&&o!==(o=l[3].length+"")&&ne(f,o),(!S||c&4&&g!==(g=l[2]==="global"))&&(d.disabled=g),(!S||c&4&&E!==(E=l[2]==="user"))&&(a.disabled=E),c&27){k=Q(l[3]);let i;for(i=0;i<k.length;i+=1){const B=R(l,k,i);r[i]?(r[i].p(B,c),V(r[i],1)):(r[i]=W(B),r[i].c(),V(r[i],1),r[i].m(b,null))}for(Y(),i=k.length;i<r.length;i+=1)Z(i);X()}},i(l){if(!S){for(let c=0;c<k.length;c+=1)V(r[c]);S=!0}},o(l){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)M(r[c]);S=!1},d(l){l&&(p(t),p(_),p(b)),re(r,l),j=!1,ee(P)}}}function ge(n,t,s){let e,o;J(n,G,_=>s(3,e=_)),J(n,L,_=>s(4,o=_));let{data:f}=t;const{getGlobalScore:m,getUserScore:d}=f;let h=new Map,g=new Map;te(async()=>{e.forEach(_=>{m(_.name).then(b=>{h.set(_.name,b),s(0,h)}),L&&d(_.name).then(b=>{g.set(_.name,b),s(1,g)})})});function u(_){se(G,e=e.sort((b,S)=>{var k,r;const j=((k=_.get(b.name))==null?void 0:k.rating)??0;return(((r=_.get(S.name))==null?void 0:r.rating)??0)-j}),e)}let a="";const y=()=>{s(2,a="global"),u(h)},E=()=>{s(2,a="user"),u(g)};return n.$$set=_=>{"data"in _&&s(6,f=_.data)},[h,g,a,e,o,u,f,y,E]}class Ie extends oe{constructor(t){super(),le(this,t,ge,be,x,{data:6})}}export{Ie as component,we as universal};
